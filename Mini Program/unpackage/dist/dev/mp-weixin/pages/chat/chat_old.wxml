<view class="chat-container"><scroll-view class="chat-messages" scroll-y="true" scroll-with-animation="true" scroll-top="{{scrollTop}}" enhanced="{{true}}" show-scrollbar="{{false}}"><block wx:for="{{$root.l1}}" wx:for-item="msg" wx:for-index="index" wx:key="index"><view class="message-item" id="{{'msg-'+index}}"><view class="{{['message',msg.$orig.role+'-message',msg.$orig.type==='audio'?'audio-message':'',msg.$orig.type==='image'?'image-message':'']}}"><block wx:if="{{msg.$orig.role==='dog'}}"><image class="avatar" src="/static/dog_avatar.png"></image></block><view class="message-content"><block wx:if="{{msg.$orig.role==='dog'&&msg.$orig.thinking}}"><view class="thinking-section"><view class="thinking-header"><uni-icons vue-id="{{'27a44058-1-'+index}}" type="compose" size="16" color="#888" bind:__l="__l"></uni-icons><text class="thinking-title">æ€è€ƒä¸­</text><block wx:if="{{msg.$orig.isThinking}}"><view class="thinking-indicator"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></block></view><view class="thinking-content">{{''+msg.$orig.thinking+''}}</view></view></block><block wx:if="{{msg.$orig.type==='text'||!msg.$orig.type}}"><block wx:if="{{msg.$orig.role==='dog'}}"><view class="answer-section">{{''+msg.$orig.content+''}}<block wx:if="{{msg.$orig.isStreaming}}"><view class="streaming-indicator"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></block></view></block><block wx:else><view>{{''+msg.$orig.content+''}}<block wx:if="{{msg.$orig.isStreaming}}"><view class="streaming-indicator"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></block></view></block></block><block wx:else><block wx:if="{{msg.$orig.type==='audio'}}"><view class="audio-content"><block wx:if="{{msg.$orig.isUploading}}"><view class="audio-uploading"><view class="uploading-icon"><uni-icons vue-id="{{'27a44058-2-'+index}}" type="spinner-cycle" size="16" color="#1a73e8" bind:__l="__l"></uni-icons></view><text class="uploading-text">æ­£åœ¨ä¸Šä¼ ...</text></view></block><block wx:else><block wx:if="{{msg.$orig.uploadFailed}}"><view data-event-opts="{{[['tap',[['retryAudioUpload',['$0','$1'],[[['messages','',index,'filePath']],[['messages','',index,'duration']]]]]]]}}" class="audio-failed" bindtap="__e"><view class="failed-icon"><uni-icons vue-id="{{'27a44058-3-'+index}}" type="closeempty" size="16" color="#ff3b30" bind:__l="__l"></uni-icons></view><text class="failed-text">{{msg.$orig.content}}</text></view></block><block wx:else><view data-event-opts="{{[['tap',[['toggleAudioPlayback',['$0',index],[[['messages','',index]]]]]]]}}" class="audio-player-container" bindtap="__e"><text class="audio-text">{{msg.$orig.content||'[è¯­éŸ³æ¶ˆæ¯]'}}</text><view class="audio-player"><view class="play-button"><uni-icons vue-id="{{'27a44058-4-'+index}}" type="{{msg.$orig.isPlaying?'pause-filled':'play-filled'}}" size="20" color="{{msg.$orig.isPlaying?'#ff3b30':'#1a73e8'}}" bind:__l="__l"></uni-icons></view><view class="wave-container"><block wx:for="{{msg.l0}}" wx:for-item="bar" wx:for-index="idx" wx:key="idx"><view class="wave-bar" style="{{'height:'+(msg.$orig.isPlaying?bar.m0+'px':'8px')+';'}}"></view></block></view><text class="time-display">{{''+msg.m1+" / "+msg.m2+''}}</text></view><view class="progress-container"><view class="progress-bar" style="{{'width:'+(msg.$orig.progress+'%')+';'}}"></view></view></view></block></block><block wx:if="{{msg.$orig.transcriptText}}"><view class="transcript-container"><view data-event-opts="{{[['tap',[['toggleTranscript',['$0',index],[[['messages','',index]]]]]]]}}" class="transcript-toggle" bindtap="__e"><text class="toggle-text">{{(msg.$orig.showTranscript?'æ”¶èµ·':'å±•å¼€')+"è½¬å½•æ–‡æœ¬"}}</text><uni-icons vue-id="{{'27a44058-5-'+index}}" type="{{msg.$orig.showTranscript?'up':'down'}}" size="16" color="#666" bind:__l="__l"></uni-icons></view><block wx:if="{{msg.$orig.showTranscript}}"><view class="transcript-content"><text class="transcript-text">{{msg.$orig.transcriptText}}</text></view></block></view></block><block wx:if="{{msg.$orig.transcribing}}"><view class="transcript-status"><text class="status-text">æ­£åœ¨è¯†åˆ«è¯­éŸ³å†…å®¹...</text></view></block></view></block><block wx:else><block wx:if="{{msg.$orig.type==='image'}}"><block wx:if="{{msg.$orig.role==='dog'}}"><view class="answer-section"><view class="image-content"><text class="image-text" style="padding:20px;">{{msg.$orig.content}}</text><block wx:if="{{msg.$orig.isStreaming}}"><view class="streaming-indicator"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></block><view class="image-container" style="{{'position:'+('relative')+';'+('width:'+('100%')+';')}}"><image class="chat-image blur-image" style="{{'position:'+('absolute')+';'+('top:'+(0)+';')+('left:'+(0)+';')+('width:'+('100%')+';')+('height:'+('100%')+';')+('filter:'+('blur(10px)')+';')+('opacity:'+(msg.$orig.imageLoaded?0:1)+';')+('transition:'+('opacity 5s ease')+';')}}" src="{{msg.m3}}" mode="widthFix"></image><image class="chat-image" style="{{'position:'+('relative')+';'+('opacity:'+(msg.$orig.imageLoaded?1:0)+';')+('transition:'+('opacity 10s ease')+';')}}" src="{{msg.m4}}" mode="widthFix" data-event-opts="{{[['load',[['handleImageLoad',['$0',index],[[['messages','',index]]]]]],['tap',[['previewImage',[msg.m5]]]],['error',[['onImageError',['$event']]]]]}}" bindload="__e" bindtap="__e" binderror="__e"></image></view></view></view></block><block wx:else><block wx:if="{{msg.$orig.role==='user'}}"><view class="answer-section"><view class="image-content"><view class="image-container" style="{{'position:'+('relative')+';'+('width:'+('100%')+';')}}"><image class="chat-image" style="{{'width:'+('100%')+';'+('height:'+('100%')+';')}}" src="{{msg.m6}}" mode="widthFix" data-event-opts="{{[['tap',[['previewImage',[msg.m7]]]],['error',[['onImageError',['$event']]]]]}}" bindtap="__e" binderror="__e"></image></view><text class="image-text" style="padding:20px;">{{msg.$orig.content}}</text></view></view></block></block></block></block></block></view><block wx:if="{{msg.$orig.role==='user'}}"><image class="avatar" src="/static/user_avatar.png"></image></block></view></view></block><view class="bottom-space"></view></scroll-view><view class="{{['bottom-section',(isKeyboardShow)?'keyboard-show':'']}}"><view class="model-selector"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="{{['model-item',(isLongThinkActive)?'active':'']}}" bindtap="__e"><text class="model-icon">âœ¦</text><text class="model-text">æ·±åº¦æ€è€ƒ</text></view><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="{{['network-item',(isWebSearchActive)?'active':'']}}" bindtap="__e"><text class="network-icon">ğŸŒ</text><text class="network-text">è”ç½‘æœç´¢</text></view></view><view class="{{['input-container',(isVoiceMode)?'voice-mode':'',(isRecording)?'recording':'']}}"><block wx:if="{{isVoiceMode}}"><view class="voice-input-area"><view data-event-opts="{{[['tap',[['toggleInputMode',['$event']]]]]}}" class="voice-btn" bindtap="__e"><image class="voice-icon" src="/static/keyboard.png" mode="aspectFit"></image></view><view data-event-opts="{{[['touchstart',[['startRecording',['$event']]]],['touchend',[['stopRecording',['$event']]]],['touchcancel',[['cancelRecording',['$event']]]]]}}" class="voice-placeholder" bindtouchstart="__e" bindtouchend="__e" bindtouchcancel="__e"><block wx:if="{{!isRecording}}"><text style="font-size:38rpx;">é•¿æŒ‰è¯´è¯</text></block><block wx:else><text style="font-size:38rpx;">æ¾å¼€ç»“æŸ</text></block></view><view data-event-opts="{{[['tap',[['showAddOptions',['$event']]]]]}}" class="add-btn" bindtap="__e"><text class="add-icon">+</text></view></view></block><block wx:else><view class="text-input-area"><view data-event-opts="{{[['tap',[['toggleInputMode',['$event']]]]]}}" class="voice-btn" bindtap="__e"><image class="voice-icon" src="/static/microphone.png" mode="aspectFit"></image></view><input class="message-input" placeholder="æœ‰ä»€ä¹ˆé—®é¢˜å°½ç®¡é—®æˆ‘" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','textMessage','$event',[]]]]]]}}" value="{{textMessage}}" bindconfirm="__e" bindinput="__e"/><view data-event-opts="{{[['tap',[['showAddOptions',['$event']]]]]}}" class="add-btn" bindtap="__e"><text class="add-icon">+</text></view><block wx:if="{{$root.g0}}"><view data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" class="send-btn" bindtap="__e"><image class="send-icon" src="/static/send.png" mode="aspectFit"></image></view></block></view></block></view></view><block wx:if="{{showAttachmentModal}}"><view data-event-opts="{{[['tap',[['hideAttachmentModal',['$event']]]]]}}" class="attachment-modal" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="attachment-content" catchtap="__e"><view data-event-opts="{{[['tap',[['selectPhoto',['$event']]]]]}}" class="attachment-item" bindtap="__e"><text class="attachment-text">æ‹ç…§</text></view><view data-event-opts="{{[['tap',[['selectAlbum',['$event']]]]]}}" class="attachment-item" bindtap="__e"><text class="attachment-text">æœ¬åœ°ç›¸å†Œ</text></view><view data-event-opts="{{[['tap',[['selectDocument',['$event']]]]]}}" class="attachment-item" bindtap="__e"><text class="attachment-text">å–æ¶ˆ</text></view></view></view></block><block wx:if="{{isRecording}}"><view class="wave-visualization"><block wx:for="{{$root.l2}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="wave-item" style="{{'height:'+(item.$orig+'px')+';'+('background-color:'+(item.m8)+';')}}"></view></block></view></block><block wx:if="{{isRecording}}"><view class="recording-status"><text>{{isCancelMode?'æ¾æ‰‹å–æ¶ˆ':'æ‰‹æŒ‡ä¸Šæ»‘ï¼Œå–æ¶ˆå‘é€'}}</text></view></block></view>